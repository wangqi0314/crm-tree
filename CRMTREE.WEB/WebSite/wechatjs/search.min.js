(function () {
    "use strict";
    function e(e) {
        var t,
            a = new RegExp("(?:^| )" + e + "=([^;]*)(?:;|$)", "gi");
        return (t = a.exec(document.cookie)) ? unescape(t[1]) : 1
    }
    function t(e, t) {
        var a = new Date;
        a.setTime(a.getTime() + 24 * 60 * 60 * 1e3);
        document.cookie = e + "=" + escape(t) + "; expires=" + a.toGMTString() + "; path=/; domain=autohome.com.cn;"
    }
    var a = {
        key: "searchhistory",
        emptydata: { a: { t: [""], k: "" }, f: { t: [""], k: "" } },
        getHistory: function () {
            var t = e(this.key);
            if (t === 1 || t === "") {
                this.clearHistory();
                return this.emptydata
            } else {
                return JSON.parse(t)
            }
        },
        setHistory: function (e) {
            t(this.key, JSON.stringify(e))
        },
        clearHistory: function () {
            t(this.key, "")
        }
    };
    var i = "click",
        n = "w-search-hide",
        s = $(".w-search"),
        r = ".w-search-input-text",
        o = ".w-search-pop-box",
        f = "#searchBar_spacer",
        c = a.getHistory(),
        l = '<span><i class="w-search-icon"></i></span>',
        d = 0,
        u = null,
        h = "//m.autohome.com.cn/",
        p = "//club.m.autohome.com.cn/bbs/forum-";
    s.on(i, ".w-search-tab-btn", function (e) {
        $(this).next().toggleClass(n);
        e.preventDefault()
    }).
        on(i, ".w-search-tab-pop a", C).
        on(i, ".w-search-pop-bar a", function (e) {
            m(); !!window.fixuc && window.fixuc();
            setTimeout(H, 250);
            e.preventDefault()
        }).
        on("focus", r, w).
        on("input", r, x).
        on(i, ".w-search-input-clear", y).
        on(i, ".w-search-pop-through a", function (e) {
            var t = $(e.target);
            D(t.text(),
                t.data("id"),
                t.data("type"));
            O(t.text());
            H()
        }).
        on(i, ".w-search-pop-normal a", function (e) {
            var t = e.target;
            if (t.nodeName.toLocaleLowerCase() === "b") { t = t.parentNode }
            var a = $(t).text();
            if (a === "") {
                return
            } T(a); O(a); H(); u.find(r).val(a.replace(/<|>/g, ""));
            u.find("form")[0].submit();
            e.preventDefault()
        }).
        on(i, ".w-search-btn", function (e) {
            e.preventDefault(); u = $(e.target).closest(".w-search");
            var t = S(u.find(r).val());
            if (t === "") {
                return
            } else { u.find(r).val(t); T(t); H() } $(e.target).closest("form")[0].submit()
        }).
        on("submit", "form", function (e) {
            u = $(e.target).closest(".w-search"); var t = S(u.find(r).val()); if (t === "") {
                e.preventDefault();
                return
            } else { u.find(r).val(t); T(t); H() }
        }).
        on(i, ".w-search-pop-clear", function () {
            u.find(".w-search-pop-box").addClass(n); u.find(".w-search-pop-through").remove();
            if (d == 2) { c.f.k = ""; c.f.t = [] } else { c.a.k = ""; c.a.t = [] } a.setHistory(c)
        }).
        on(i, "dd span", function () {
            var e = $(this).prev().text(); u.find(r).val(e)[0].focus()
        });
    function m() {
        setTimeout(
            function () {
                window.scrollTo(0, u.offset().top - 10)
            }, 50)
    }
    function w(e) {
        var t = "", a = "";
        if (e) {
            a = $(e.target).val();
            u = $(e.target).closest(".w-search")
        }
        var i = u.find("form").attr("action");
        if (i.indexOf("wenzhang") > -1) {
            d = 1
        }
        else if (i.indexOf("luntan") > -1) {
            d = 2
        } else if (i.indexOf("shipin") > -1) {
            d = 3
        }
        m();
        if (a !== "") {
            x()
        } else {
            var s = u.find(o),
                t = b(
                g(),
                v(),
                true);
            if (t != "") {
                s.html(t).removeClass(n)
            } else {
                s.addClass(n)
            }
        }
        if ($(document).height() - u.offset().top < $(window).height()) {
            if ($(f).length === 0) {
                $('<div id="searchBar_spacer">').css("height", 380).appendTo($("body"))
            }
        }
    }
    function v() {
        var e = [], t = ""; if (c != null) {
            if (d === 2) { e = c.f.k.split(",") } else { e = c.a.k.split(",") } e.forEach(
                function (e) { if (e != "") { t += '<dd><a href="' + e + '">' + e + "</a>" + l } })
        } return t
    }
    function g() {
        var e = [],
            t = [],
            a = "",
            i = "c";
        if (c != null) {
            if (d === 2) {
                e = c.f.t
            } else {
                e = c.a.t
            } e.forEach(
            function (e) {
                if (e != "") {
                    t = e.split("@");
                    if (d === 2) {
                        if (t[2] !== "") {
                            i = t[2]
                        }
                        a += '<dd><a href="' + p + i + "-" + t[1] + '-1.html" data-id="' + t[1] + '" data-type="' + i + '">' + t[0] + "</a>" + l
                    }
                    else {

                        a += '<dd><a href="' + h + t[1] + '/" data-id="' + t[1] + '">' + t[0] + "</a>" + l
                    }
                }
            })
        } return a
    }
    function b(e, t, a) {
        if (e === "" && t === "") {
            return ""
        } var i = "", n = "", s = "";
        if (d === 2) { n = s = "论坛" }
        else if (d === 3) { n = s = "视频" }
        else if (d === 1) { n = "车系"; s = "文章" }
        else { n = "车系"; s = "综合" } if (e !== "") {
            i += '<dl class="w-search-pop-through">';
            i += '<dt><i class="w-search-icon"></i>直达' + n + "</dt>";
            i += e;
            i += "</dl>"
        } if (t !== "") {
            i += '<div class="w-search-pop-divi"></div>';
            i += '<dl class="w-search-pop-normal">';
            i += '<dt><i class="w-search-icon"></i>' + s + "搜索</dt>";
            i += t; i += "</dl>"
        }
        i += '<div class="w-search-pop-bar">';
        if (a) {
            i += '<a class="w-search-pop-clear">清除历史记录</a>'
        }
        i += '<a class="w-search-pop-close">关闭</a>';
        i += "</div>";
        i += "</div>";
        return i
    }
    function x() {
        var e = this !== undefined ? $(this) : u.find(r),
            t = e.val(),
            a = "//sou.m.autohome.com.cn/Api/",
            i = a + "Suggestword/search",
            s = a + "VideoSuggestword/search",
            o = a + "TopicSuggestword/search";
        if (t !== "") {
            e.parent().find(".w-search-input-clear").removeClass(n)
        } else {
            e.parent().find(".w-search-input-clear").addClass(n);
            y();
            return
        }
        var f = i;
        if (d === 2) {
            f = o
        }
        else if (d === 3) {
            f = s
        } $.ajax({
            url: f,
            data: { q: encodeURIComponent(t) },
            dataType: "jsonp",
            success: function (e) {
                if (e.returncode === 0) {
                    k(e.result, t)
                }
                else {
                    console.error("interface data error：" + e.message)
                }
            }
        })
    }
    function y(e) {
        $(this).addClass(n).parent().find("input").eq(0).val("");
        if (u === null) {
            u = $(e.target).closest(".w-search")
        }
        u.find(".w-search-pop-through,.w-search-pop-divi,.w-search-pop-normal").remove();
        w();
        u.find(r)[0].focus();
        if (e) {
            e.stopPropagation();
            e.preventDefault()
        }
    } function k(e, t) {
        var a = u.find("input"), i = "";
        if (e.length > 0) {
            var s = "",
                r = "";
            e.forEach(
                function (e) {
                    if (e.wordtype === 3) {
                        if (d === 2) {
                            s += '<dd><a href="' + p + e.bbs + "-" + e.wordid + '-1.html" data-id="' + e.wordid + '" data-type="' + e.bbs + '">' + e.name + "</a>" + l
                        }
                        else {
                            s += '<dd><a href="' + h + e.wordid + '/" data-id="' + e.wordid + '">' + e.name + "</a>" + l
                        }
                    } else {
                        r += '<dd><a href="' + e.name + '">' + e.name.replace(t, "<b>" + t + "</b>") + '</a><span><i class="w-search-icon"></i></span>'
                    }
                });
            i = b(s, r);
            $(o, u).html(i).removeClass(n)
        } else {
            $(o, u).addClass(n)
        }
    }
    function C(e) {
        $(".w-search-tab-btn", s).html($(this).text() + "<i></i>");
        var t = $(this), a = t.index(), i = t.closest("form"), f = "", c = i.data("action");
        if (a === 0) { f = "zonghe"; d = 0 }
        else if (a === 1) { f = "wenzhang"; d = 1 }
        else if (a === 2) { f = "luntan"; d = 2 }
        else if (a === 3) { f = "shipin"; d = 3 } i.attr("action", c + f);
        if (i.find(r).val() !== "") { i[0].submit() }
        else { t.parent().addClass(n) } $(this).closest(o).addClass(n);
        e.preventDefault()
    }
    function T(e) {
        var t = [], i = "";
        if (d === 2) { i = c.f.k ? c.f.k : "" }
        else { i = c.a.k ? c.a.k : "" }
        if (i.indexOf(e) > -1) {
            return
        } else {
            t = i.split(",");
            if (t.length === 0) {
                t.push(e)
            }
            else {
                t.unshift(e);
                if (t.length > 3) {
                    t.pop(3)
                }
            } if (d === 2) { c.f.k = t.join(",") }
            else { c.a.k = t.join(",") } a.setHistory(c)
        }
    }
    function D(e, t, i) {
        var n = [];
        if (i === undefined) { i = "" }
        if (d === 2) { n = c.f.t }
        else { n = c.a.t }
        if (n.join(",").indexOf(t) > -1) {
            return
        } else {
            n.unshift(e + "@" + t + "@" + i);
            if (n.length > 3) { n.pop(3) }
            if (d === 2) { c.f.t = n }
            else { c.a.t = n } a.setHistory(c)
        }
    }
    function H() {
        u.find(o).addClass(n);
        $(f) && $(f).detach()
    }
    function O(e) {
        var t = new Image, a = "//sou.autohome.com.cn/stats/TipWordSouLog.ashx?word=" + e + "&type=", i = u.find(".w-search-tab-btn").text(), n = 30; if (i === "文章") { n = 31 } else if (i === "论坛") { n = 32 } else if (i === "视频") { n = 33 } a += n; t.src = a; return
    }
    function S(e) {
        return $.trim(e.replace(/<|>|!#$%^&#$%^&amp;*()\[\]\{\}\?,\&#$%^&amp;*()\[\]\{\}\?,\&lt;\&#$%^&amp;*()\[\]\{\}\?,\&lt;\&gt;，。【】（）/g, ""))
    }
})();